安装

```shell
sudo yum install -y nginx
sudo systemctl enable nginx
```

使用配置文件

```nginx
user             nginx nginx;
worker_processes auto;
pid              /var/run/nginx.pid;
error_log        /var/log/nginx/error.log;

events {
    worker_connections 65535;
    multi_accept       on;
    use                epoll;
}

http {

    log_format  main  '$remote_addr|$http_x_real_ip - $remote_user [$time_local] "$host $request $request_body" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';
    access_log   off;

    include      /etc/nginx/mime.types;
    default_type application/octet-stream;

    server_tokens off;
    sendfile      on;
    tcp_nodelay   on;

    gzip            on;
    gzip_proxied    any;
    gzip_comp_level 4;
    gzip_min_length 1000;
    gzip_types      *;

    # 为了获取用户真实IP
    set_real_ip_from 192.168.0.0/16;
    set_real_ip_from 10.0.0.0/8;
    set_real_ip_from 127.0.0.1;
    real_ip_header   X-Forwarded-For;

     # 超时
    # client_header_timeout   4000s;
    # client_body_timeout     4000s;
    # keepalive_timeout       4000s;
    # proxy_connect_timeout   4000s;
    # proxy_read_timeout      4000s;
    # proxy_send_timeout      4000s;
    # fastcgi_connect_timeout 4000s;
    # fastcgi_read_timeout    4000s;
    # fastcgi_send_timeout    4000s;


    # include /etc/nginx/conf.d/*.conf;
    #server {
    #    listen 80 default_server;
    #    server_name _;
    #    return 500;
    #}
    #server {
    #    listen 443 ssl default_server;
    #    server_name _;
    #    ssl_certificate     /keys/server.crt;
    #    ssl_certificate_key /keys/server.pem;
    #    return 500;
    #}

    server {
        listen 80;
        return 301 https://$host$request_uri;
    }

    server {
        listen     127.0.0.1:81;
        access_log off;

        location = /nginx-status {
            stub_status on;
        }
        location = /phpfpm-status {
            include       fastcgi_params;
            fastcgi_pass  127.0.0.1:9000;
            fastcgi_param SCRIPT_FILENAME $fastcgi_script_name;
        }
    }

    server {
        listen 80;
        root   /opt/www;
        index  index.html index.php;

        location / {
            if (!-e $request_filename) {
                rewrite ^(.*)$ /index.php?s=$1 last;
                break;
            }
        }
        location ~ \.php$ {
            access_log /var/log/nginx/access.log main;
            if ( "$request_filename" != "/opt/www/php/public/index.php" ) {
                return 403;
            }
            try_files     $uri =404;
            fastcgi_pass  127.0.0.1:9000;
            fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
            include       fastcgi_params;
        }
        location ~*  \.(js|css|ico|png|jpg|jpeg|gif|flv|ttf)$ {
            expires          max;
          # limit_rate_after 500k;
          # limit_rate       50k;
            access_log       off;
            log_not_found    off;
        }

        location ^~ /.git/    { return 403; }
        location ^~ /Runtime/ { return 403; }
        location ^~ /Uploads/ { location ~ \.php$ {return 403;} }
    }

    server {
        listen 443 ssl;
        server_name ws.g9955.com;

        ssl_certificate     /keys/null.crt;
        ssl_certificate_key /keys/null.pem;

        location / {
            # proxy_read_timeout 24h;
            # proxy_send_timeout 24h;
            # client_max_body_size 0;
            # proxy_set_header Host $host;
            # proxy_set_header X-Real-IP $http_x_real_ip; 
            # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_pass http://127.0.0.1:8282;
        }
    }

   # 前后端分离配置
   #
   # # php
   # server {
   #     listen 127.0.0.1:8080;
   #     root   /opt/www/php/public;
   #     index  index.html index.php;
   #
   #     location / {
   #         if (!-e $request_filename) {
   #             rewrite ^(.*)$ /index.php?s=$1 last;
   #             break;
   #         }
   #     }
   #     location ~ \.php$ {
   #         access_log  /var/log/nginx/access.log  main;
   #         if ( "$request_filename" != "/opt/www/php/public/index.php" ) {
   #             return 403;
   #         }
   #         try_files $uri =404;
   #         fastcgi_pass  127.0.0.1:9000;
   #         fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
   #         include       fastcgi_params;
   #     }
   # }
   #
   # # admin page
   # server {
   #     listen 80;
   #     server_name tradecenter-dev.e2048.com;
   #
   #     # 仅仅允许管理员IP
   #     allow 192.168.0.0/16;
   #     allow 10.0.0.0/8;
   #     allow 127.0.0.1;
   #     deny all;
   #
   #     location / {
   #         proxy_set_header Host $host;
   #         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   #         proxy_pass http://127.0.0.1:8080;
   #     }
   # }
   #
   # # api in peizhi
   # server {
   #     listen 80;
   #     server_name api.tradecenter.local;
   #
   #     # 仅仅允许内网
   #     allow 192.168.0.0/16;
   #     allow 10.0.0.0/8;
   #     allow 127.0.0.1;
   #     deny all;
   #
   #     location / {
   #         proxy_set_header Host $host;
   #         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   #         proxy_pass http://127.0.0.1:8080/api/;
   #     }
   # }
   #
   # # html page
   # server {
   #     listen 80;
   #     root   /opt/www/html/pc;
   #     index  index.html;
   #     server_name www-tradecenter-dev.e2048.com;
   #
   #     location / {
   #         if ($http_user_agent ~* "(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino") {
   #             root /opt/www/html/mobile;
   #         }
   #     }
   #     location ~* /server/(admin|api).* {
   #         return 403;
   #     }
   #     location ~ /server/(.*) {
   #         proxy_set_header Host $host;
   #         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
   #         proxy_pass http://127.0.0.1:8080/$1?$query_string;
   #     }
   # }
}
```



