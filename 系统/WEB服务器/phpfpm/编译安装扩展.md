#### 编译追加扩展

下载解压 php 源码包

```
tar -xvf /admin/php-7.0.23.tar.xz
```

编译和安装

```
cd php-7.0.23/ext/mbstring/
/opt/php-fpm/bin/phpize
./configure --with-php-config=$(which php-config)
make
make install
```

安装到

```
/opt/php-fpm/lib/php/extensions/no-debug-non-zts-20151012/mbstring.so
```

修改 php.ini

```
php.ini中追加extension=mbstring.so
```

重新加载 php 进程

> [https://my.oschina.net/u/2245781/blog/913938](https://my.oschina.net/u/2245781/blog/913938)

---

### php-fpm.conf

```
pid = /run/php-fpm/php-fpm.pid
error_log = /var/log/php-fpm/error.log

[www]
listen = 127.0.0.1:9000
listen.allowed_clients = 127.0.0.1
user = php-fpm
group = php-fpm
pm = dynamic                  ; 基于该动作设置子进程的数量
pm.max_children = 6           ; 创建的最大子进程数
pm.start_servers = 2          ; 启动时创建的子进程数
pm.min_spare_servers = 2      ; 所需的最小空闲服务器进程数
pm.max_spare_servers = 4      ; 所需的最大空闲服务器进程数
; 将会话路径设置为进程用户拥有的目录
;php_value[session.save_handler] = files
；php_value[session.save_path] = /var/lib/php/session
```

> 允许任意 IP 远程连接 php-fpm 改 listen.allowed\_clients 为 0.0.0.0

---

fpm 进程支持 USER2 信号，用于重新加载配置文件

`kill -USR2 [pid]`

> [http://php.net/manual/zh/install.fpm.php\#104691](http://php.net/manual/zh/install.fpm.php#104691)



